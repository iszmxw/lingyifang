<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>我的关注</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/public/light7.min.css">
    <link rel="stylesheet" href="css/attention_store_list.css">
  </head>
  <body>
    <div class="page page-current">
	    <div class="g-flexview">
			<div class="g-scrollview" id="g-scrollview">
				<div class="header">
					<span class="icon_left"></span>
					我的关注
				</div>
				<p class="tips">我关注了<font color="#fd473c">87</font>家零壹坊联盟店</p>
				<div class="follow_box pay-list">
					<div class="follow_list pay-each animatedh" data-transx="0">
						<div class="list_left">
							<div class="icon_store">
								<img src="images/ceshituian.jpg">
							</div>
							<div class="info">
								<p class="tit">都市书城</p>
								<p class="count">475人关注</p>
							</div>
							<div class="more"></div>
						</div>
						<div class="list_right pay-order-swiper">
							<a href="JavaScript:;" onclick="quxiao()">取消关注</a>
							<a href="JavaScript:;" class="go_url" onclick="go_url()">进店逛逛</a>
						</div>
					</div>

					<div class="follow_list pay-each animatedh" data-transx="0">
						<div class="list_left">
							<div class="icon_store">
								<img src="images/ceshituian.jpg">
							</div>
							<div class="info">
								<p class="tit">都市书城</p>
								<p class="count">475人关注</p>
							</div>
							<div class="more"></div>
						</div>
						<div class="list_right pay-order-swiper">
							<a href="JavaScript:;" onclick="quxiao()">取消关注</a>
							<a href="JavaScript:;" class="go_url" onclick="go_url()">进店逛逛</a>
						</div>
					</div>

					<div class="follow_list pay-each animatedh" data-transx="0">
						<div class="list_left">
							<div class="icon_store">
								<img src="images/ceshituian.jpg">
							</div>
							<div class="info">
								<p class="tit">都市书城</p>
								<p class="count">475人关注</p>
							</div>
							<div class="more"></div>
						</div>
						<div class="list_right pay-order-swiper">
							<a href="JavaScript:;" onclick="quxiao()">取消关注</a>
							<a href="JavaScript:;" class="go_url" onclick="go_url()">进店逛逛</a>
						</div>
					</div>

					<div class="follow_list pay-each animatedh" data-transx="0">
						<div class="list_left">
							<div class="icon_store">
								<img src="images/ceshituian.jpg">
							</div>
							<div class="info">
								<p class="tit">都市书城</p>
								<p class="count">475人关注</p>
							</div>
							<div class="more"></div>
						</div>
						<div class="list_right pay-order-swiper">
							<a href="JavaScript:;" onclick="quxiao()">取消关注</a>
							<a href="JavaScript:;" class="go_url" onclick="go_url()">进店逛逛</a>
						</div>
					</div>
				</div>
			</div>
	    </div>
    </div>
    <script type="text/javascript" src="http://develop2.01nnt.com/personal/public/Wechat/js/public/jquery.min.js"></script>
    <script type='text/javascript' src='js/public/light7.min.js' charset='utf-8'></script>
<script type="text/javascript">
//因为冒泡了，会执行到下面的方法。
function stopPropagation(e) {
    var ev = e || window.event;
    if (ev.stopPropagation) {
        ev.stopPropagation();
    }
    else if (window.event) {
        window.event.cancelBubble = true;//兼容IE
    }
}
$ (".more").click (function (e){
	stopPropagation(e);
    // 不用写太多，用jquery要活学活用，只知道parent，不知道parents，是无用的。
    $(this).parents("div.list_left").animate({'left':'-200px'});
    $(this).parents("div.follow_list").find('.list_right').animate({'right':'0px'});
});
$("body").click(function(e){
	stopPropagation(e);
	$(".list_left").animate({'left':'0px'});
    $(".list_right").animate({'right':'-200px'});
})
function quxiao(e){
	stopPropagation(e);
}
function go_url(e){
	stopPropagation(e);
}




//滑动删除
function prevent_default(e) {
    e.preventDefault();
}

function disable_scroll() {
    $(document).on('touchmove', prevent_default);
}

function enable_scroll() {
    $(document).off('touchmove', prevent_default);
}

//滑动删除
var Drags = {};
Drags.dragtag = false;//拖动状态
Drags.dragstart = true;//拖动开始标志
Drags.datatransx = 0;
$('.follow_box .follow_list')
    .on('touchstart mousedown', function (e) {
        if (!($(e.target).hasClass("pay-order-swiper") || $(e.target).parents().hasClass("pay-order-swiper"))) {
            closeallswipe();     //点击还原
            if (e.originalEvent.targetTouches) {
                Drags.dragx = e.originalEvent.targetTouches[0].pageX;
                Drags.dragy = e.originalEvent.targetTouches[0].pageY;
            } else {
                Drags.dragx = e.pageX;
                Drags.dragy = e.pageY;
            }
            if ($(e.currentTarget).attr("data-transX")) {
                Drags.datatransx = parseInt($(e.currentTarget).attr("data-transX"));
            }
            Drags.dragtag = true;
            Drags.dragstart = true;
        }
    })
    .on('touchmove mousemove', function (e) {
        if (Drags.dragtag) {
            $(e.currentTarget).removeClass('animatedh');
            $(e.currentTarget).addClass('dragstart');   //添加禁止选择
            var change = 0;
            if (e.originalEvent.targetTouches) {
                change = e.originalEvent.targetTouches[0].pageX - Drags.dragx;
                changey = e.originalEvent.targetTouches[0].pageY - Drags.dragy;
            } else {
                change = e.pageX - Drags.dragx;
                changey = e.pageY - Drags.dragy;
            }

            if (Drags.dragstart) {
                if (Math.abs(changey) < 20) {
                    showswiperfbn();
                }
            } else {
                showswiperfbn();
            }

            function showswiperfbn() {
                if (Math.abs(change) > 20) {
                    Drags.dragstart = false;
                    if (change < -20) {
                        change = change + Drags.datatransx + 20;
                    } else {
                        change = change + Drags.datatransx - 20;
                    }
                    change = Math.min(Math.max(-300, change), 0);
                    $(e.currentTarget).css('transform', 'translate3D(' + change + 'px,0px,0px)');
                    $(e.currentTarget).attr("data-transX", change);
                    disable_scroll();
                }
            }
        }
    })
    .on('touchend mouseup', function (e) {
        var left = parseInt($(e.currentTarget).attr("data-transX"));
        var new_left;
        if ($(e.currentTarget).hasClass("open")) {
            if (left > -110) {
                new_left = 0;
                $(e.currentTarget).removeClass('open');
            } else {
                new_left = -200;
            }
        } else {
            if (left < -20) {
                new_left = -200;
                $(e.currentTarget).addClass('open');
            } else {
                new_left = 0;
            }
        }
        $(e.currentTarget).removeClass('dragstart');
        $(e.currentTarget).css('transform', 'translate3D(' + new_left + 'px,0px,0px)');
        $(e.currentTarget).attr("data-transX", new_left);
        $(e.currentTarget).addClass('animatedh');
        Drags.dragtag = false;
        enable_scroll()
    });

function closeallswipe() {
    $('.pay-list .pay-each').css('transform', 'translate3D(0px,0px,0px)');
    $('.pay-list .pay-each').removeClass('open');
    $('.pay-list .pay-each').addClass('animatedh');
    $('.pay-list .pay-each').attr("data-transX", 0);
}
</script>
</body>	
</html>
